<!DOCTYPE html>
<!-- Copyright Â© 2016 Chromium authors and World Wide Web Consortium, (Massachusetts Institute of Technology, ERCIM, Keio University, Beihang). -->
<html>
    <head>
        <title>EventListener and dispatchEvent test case.</title>
        <meta name="timeout" content="long">
        <script src="/resources/testharness.js"></script>
        <script src="/resources/testharnessreport.js"></script>
        <script src="mediasource-util.js"></script>
    </head>
    <body>
        <div id="log"></div>
        <script>                        
          mediasource_test(function(test, mediaElement, mediaSource)
          {
              // use event name 'has' to check for bug 40470560 where
              // we would mistakently use javascript properties instead of map
              let eventName = 'has';
              
              test.expectEvent(mediaElement, eventName, 'mediaElement');
              mediaSource.addEventListener(eventName, test.step_func_done());
              
              let mediaElementEvent = new CustomEvent('has', {});
              test.waitForExpectedEvents(function()
              {
                  let mediaSourceEvent = new CustomEvent('has', {});
                  mediaSource.dispatchEvent(mediaSourceEvent);
              });
              mediaElement.dispatchEvent(mediaElementEvent);
          }, "Test dispatchEvent for custom event type 'has'");
        </script>
    </body>
</html>
